/*! $.autocomplete a.k.a. peso.autocomplete v0.1.0 https://github.com/faddee/peso-autocomplete */(function(a){var b=this.$,c=this.PESO_AUTOCOMPELTE_NAME||"autocomplete",d={url:a,type:a,source:[],minLength:2,maxResults:10,wrap:!0,classPrefix:c,classWrapper:"",classInput:"__input",classResultList:"__results",classResultItem:"__item",classResultLink:"__link"},e=function(a){return{markupWrapper:'<div class="'+a.classPrefix+a.classWrapper+'">',markupResultList:'<ul class="'+a.classPrefix+a.classResultList+'">',markupResultItem:'<li class="'+a.classPrefix+a.classResultItem+'">',markupResultLink:'<a class="'+a.classPrefix+a.classResultLink+'">'}},f={enter:13,esc:27,up:38,down:40},g=function(a){var c=b(a);return!(!c.width()&&!c.height())&&"none"!==c.css("display")},h=function(a){return a=+a,"number"===b.type(a)&&a>0&&(a===f.enter||a===f.esc||a===f.up||a===f.down)},i=function(a){var c=b.extend({},d,a);this.settings=b.extend({},e(c),c)};i.prototype={build:function(a){var d=this,e=d.settings,f=(d.suggestions=null,d.$input=b(a)),i=d.$results=b(e.markupResultList),j=d.$wrapper,k=function(a){a.stopPropagation()};return"string"===b.type(e.classInput)&&f.addClass(e.classPrefix+e.classInput),e.wrap===!0?(j=b(e.markupWrapper),f.wrap(j),j.on("click."+c,k)):f.add(i).on("click."+c,k),!e.url&&b.isArray(e.source)?d.open=function(){return this.fetch("source"),this}:"string"===b.type(e.url)&&(d.open=function(){return this.fetch("ajax"),this}),f.on(c,function(a,b){"open"===b?d.open():"close"===b&&d.close()}).on("focus keyup",function(a){var b=f.val().length,c="keyup"===a.type&&(a.keyCode||a.which);h(c)?d.keyEvent(c,a.target):d.isMinLength(b)?d.open():g(i)&&d.close()}),i.hide().insertAfter(f).on("keyup."+c,"a",function(a){var b=a.keyCode||a.which||null;h(b)&&d.keyEvent(b,a.target)}).on("click."+c,"a",function(a){a.preventDefault(),f.val(b(this).data("suggestion")),d.close()}),d},fetch:function(a){var c=this,d=c.settings,e=c.$input.val(),f=c.latestQuery;if("string"===b.type(f)&&b.isArray(c.suggestions)&&e===f)return c.generateResults(),this;if(c.latestQuery=e,"source"===a){var g=new RegExp("^"+e);c.suggestions=b.grep(d.source,function(a){return a.match(g)}),c.generateResults()}else"ajax"===a&&b.ajax({type:d.type,url:d.url,data:{q:e},success:function(a){c.suggestions=a,c.generateResults()}});return c},generateResults:function(){var a=this,d=a.settings,e=+d.maxResults,f=a.suggestions,g=a.$results,h=b(d.markupResultItem),i=b(d.markupResultLink);if(!b.isArray(f))throw a.close(),new Error("The suggestions must be an Array");return f.length?("number"===b.type(e)&&e>0&&f.length>e&&(f=f.slice(0,e)),g.empty(),b.each(f,function(a,b){var c=h.clone(),d=i.clone();d.attr("href","#").text(b).data("suggestion",b),c.append(d),g.append(c)}),g.show(),b(document).one("click."+c,function(){a.close()}),a):a},close:function(){{var a=this,d=a.$results;a.$input}return d.hide().empty(),b(document).off("click."+c),a},keyEvent:function(a,d){var e=this,h=b(d),i=e.$results,j=e.$input,k=function(){var a=h[0]===j[0];a||h.trigger("click."+c)},l=function(){e.close()},m=function(){var b=(+a===f.esc,+a===f.up),c=+a===f.down,d=g(i),k=h[0]===j[0],l=d&&!k;if(k&&c&&e.isMinLength(j.val().length))d||e.open(),i.children(":first-child").children().focus();else if(d&&k&&b||l&&c&&h.parent().is(":last-child"))e.close();else if(l&&b&&h.parent().is(":first-child"))j.focus();else if(l){var m=c&&"next"||b&&"prev";h.parent()[m]().children().focus()}};switch(+a){case f.enter:k();break;case f.esc:l();break;case f.up:case f.down:m()}return e},isMinLength:function(a){var b=+this.settings.minLength;return b>0&&+a>=b||!b}},b.fn[c]=function(a){return this.each(function(){var c=b(this);if(!c.is("input")||!c.is(":not([type])")&&!c.is("[type=text]"))throw new Error("Cannot add autocompletion to element other then input[type=text]");new i(a).build(this)})}}).call(this);