/*! $.autocomplete a.k.a. peso.autocomplete v0.2.2 https://github.com/faddee/peso-autocomplete */(function(a){var b=this.$,c=this.PESO_AUTOCOMPELTE_NAME||"autocomplete",d={source:[],ajax:{},fieldName:"q",minLength:2,maxResults:10,delay:500,create:null,change:null,search:null,response:null,open:null,focus:null,select:null,close:null,wrap:!0,classPrefix:c,classWrapper:"",classInput:"__input",classResultList:"__results",classResultItem:"__item",classResultLink:"__link"},e=function(a){return{markupWrapper:'<div class="'+a.classPrefix+a.classWrapper+'">',markupResultList:'<ul class="'+a.classPrefix+a.classResultList+'">',markupResultItem:'<li class="'+a.classPrefix+a.classResultItem+'">',markupResultLink:'<a class="'+a.classPrefix+a.classResultLink+'">'}},f=["close","destroy"],g=[],h={enter:13,esc:27,up:38,down:40},i=function(a){return b.grep(g,function(b){return b.input===a})[0]||null},j=function(a){a.stopPropagation()},k=function(a){var c=b(a);return!(!c.width()&&!c.height())&&"none"!==c.css("display")},l=function(a){return a=+a,"number"===b.type(a)&&a>0&&(a===h.enter||a===h.esc||a===h.up||a===h.down)},m=function(a){var c=b.extend({},d,a);this.settings=b.extend({},e(c),c)};m.prototype={build:function(a){var d=this,e=d.settings,f=(e.create,d.suggestions=null,d.input=a,d.$input=b(a)),i=(d.original=f.clone()[0],d.$results=b(e.markupResultList));if("string"===b.type(e.classInput)&&f.addClass(e.classPrefix+e.classInput),e.wrap===!0){var m=d.$wrapper=b(e.markupWrapper);f.wrap(m)}return f.add(i).on("click."+c,j),b.isArray(e.source)?d.method="array":"string"===b.type(e.source)&&(d.method="ajax"),f.attr("autocomplete","off").data("current-value",f.val()).on("focus."+c+" keydown."+c,function(a){var b=f.val(),c=b.length,e=a.type,g="keyup"===e&&a.keyCode||a.which,j=l(g),m="focus"===e,n=f.data("current-value"),o=function(a){d.isMinLength(c)?d.open(a):k(i)&&d.close()};f.data("current-value",b),j?((g===h.up||g===h.down)&&a.preventDefault(),d.keyHandler(g,a.target)):(m||b!==n&&d.trigger("change"))&&o(!m)}),i.hide().insertAfter(f).on("focus."+c,"a",function(){var a={target:this,value:b(this).data("suggestion")};d.trigger("focus",a)}).on("keydown."+c,"a",function(a){var b=a.keyCode||a.which||null;l(b)&&((b===h.up||b===h.down)&&a.preventDefault(),d.keyHandler(b,a.target))}).on("click."+c,"a",function(a){var c={target:this,value:b(this).data("suggestion")};a.preventDefault(),d.trigger("select",c)&&f.val(b(this).data("suggestion")),d.close()}),d.trigger("create"),g.push(this),d},open:function(b){var c=this,d=function(){c.fetch(c.method)};return c.timeout!==a&&(clearTimeout(c.timeout),delete c.timeout),b===!0?c.timeout=setTimeout(d,c.settings.delay):d(),this},fetch:function(){var c,d=this,e=d.settings,f=d.method,g=d.$input.val(),h=d.latestQuery,i=e.source;if("string"!==b.type(g)||!d.isMinLength(g.length))return d;if(d.trigger("search"),"string"===b.type(h)&&b.isArray(d.suggestions)&&g===h)return d.generateResults(),this;if(d.latestQuery=g,"function"===f)c={content:i(g)},d.trigger("response",c),d.suggestions=c.content,d.generateResults();else if("array"===f){var j=new RegExp("^"+g);c={content:b.grep(i,function(a){return a.match(j)})},d.trigger("response",c),d.suggestions=c.content,d.generateResults()}else if("ajax"===f){var k=e.fieldName,l={},m=d.request;if(m!==a&&b.isFunction(m.abort)&&m.abort(),"string"!==b.type(k))throw new Error("The field name is not a string.");l[e.fieldName]=g;var n=b.extend(!0,{},e.ajax,{url:i,data:l,success:function(a,f,g){var h=e.ajax.success;delete d.request,b.isFunction(h)&&h.call(this,a,f,g),c={content:a},d.trigger("response",c),d.suggestions=c.content,d.generateResults()}});d.request=b.ajax(n)}return d},generateResults:function(){var a=this,c=a.settings,d=+c.maxResults,e=a.suggestions,f=a.$results,g=b(c.markupResultItem),h=b(c.markupResultLink);if(!b.isArray(e))throw a.close(),new Error("The suggestions must be an Array");return e.length?("number"===b.type(d)&&d>0&&e.length>d&&(e=e.slice(0,d)),f.empty(),b.each(e,function(a,b){var c=g.clone(),d=h.clone();d.attr("href","#").text(b).data("suggestion",b),c.append(d),f.append(c)}),f.show(),a.trigger("open"),a):a},keyHandler:function(a,d){var e=this,f=b(d),g=e.$results,i=e.$input,j=function(){var a=f[0]===i[0];a||f.trigger("click."+c)},l=function(){e.close()},m=function(){var b=(+a===h.esc,+a===h.up),c=+a===h.down,d=k(g),j=f[0]===i[0],l=d&&!j;if(j&&c&&e.isMinLength(i.val().length))d||e.open(),g.children(":first-child").children().focus();else if(d&&j&&b)e.close();else if(l&&b&&f.parent().is(":first-child"))i.focus();else if(l){var m=c&&"next"||b&&"prev";f.parent()[m]().children().focus()}};switch(+a){case h.enter:j();break;case h.esc:l();break;case h.up:case h.down:m()}return e},trigger:function(a){var d=this,e=d.settings[a],f=b.Event(c+a),g=Array.prototype.slice.call(arguments);return g.splice(0,1),d.$input.trigger(f,g),!(b.isFunction(e)&&e.apply(d.input,[f].concat(g))===!1||f.isDefaultPrevented())},close:function(){var a=this,b=a.$results;return b.hide().empty(),a.trigger("close"),a},destroy:function(){var c=this,d=(c.settings,c.$input),e=c.$results,f=b.inArray(c,g);e.remove(),c.$wrapper!==a&&d.unwrap(),d.replaceWith(c.original),f>-1&&g.splice(f,1)},isOpen:function(){return k(this.$results)},isMinLength:function(a){var b=+this.settings.minLength;return b>0&&+a>=b||!b}},b.fn[c]=function(a){return this.each(function(){var c=this,d=b(this);if(!d.is("input")||!d.is(":not([type])")&&!d.is("[type=text]"))throw new Error("Cannot add autocompletion to element other then input[type=text]");if("string"===b.type(a)&&a){var e=i(c);null!==e&&-1!==b.inArray(a,f)&&e[a]()}else new m(a).build(this)})},b(document).on("click."+c,function(){b.each(g,function(){var a=this;a.isOpen()&&a.close()})})}).call(this);