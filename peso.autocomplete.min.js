/*! $.autocomplete a.k.a. peso.autocomplete v0.3.0 https://github.com/faddee/peso-autocomplete */(function(a){var b=this.$,c=this.document,d=b(c),e=this.PESO_AUTOCOMPELTE_NAME||"autocomplete",f={source:[],ajax:{},fieldName:"q",minLength:2,maxResults:10,delay:500,highlight:!0,create:null,change:null,search:null,response:null,open:null,focus:null,select:null,close:null,wrap:!0,appendTo:null,classPrefix:e,classWrapper:"",classInput:"__input",classResultList:"__results",classResultItem:"__item",classResultLink:"__link",classHighlight:"__highlight"},g=function(a){return{markupWrapper:'<div class="'+a.classPrefix+a.classWrapper+'"></div>',markupResultList:'<ul class="'+a.classPrefix+a.classResultList+'"></ul>',markupResultItem:'<li class="'+a.classPrefix+a.classResultItem+'"></li>',markupResultLink:'<a class="'+a.classPrefix+a.classResultLink+'" href="#" tabindex="-1"></a>',markupHighlight:'<span class="'+a.classPrefix+a.classHighlight+'"></span>'}},h=["close","destroy"],i=[],j={enter:13,esc:27,up:38,down:40,tab:9},k=function(a){return b.grep(i,function(b){return b.input===a})[0]||null},l=function(a){var c=b(a);return!(!c.width()&&!c.height())&&"none"!==c.css("display")},m=function(a){return a=+a,"number"===b.type(a)&&a>0&&(a===j.enter||a===j.esc||a===j.up||a===j.down)},n=function(a){var c=b.extend({},f,a);this.settings=b.extend({},g(c),c)};n.prototype={build:function(a){var c=this,e=c.settings,f=(c.suggestions=null,b(e.appendTo)),g=(c.input=a,c.$input=b(a)),h=(c.original=g.clone()[0],c.$results=b(e.markupResultList).hide());if("string"===b.type(e.classInput)&&g.addClass(e.classPrefix+e.classInput),f.length>0)h.appendTo(f.get(0));else{if(e.wrap===!0){var k=c.$wrapper=b(e.markupWrapper);g.wrap(k)}h.insertAfter(g)}return b.isFunction(e.source)?c.method="function":b.isArray(e.source)?c.method="array":"string"===b.type(e.source)&&(c.method="ajax"),c.previousValue=g.val(),g.attr("autocomplete","off").on("keyup focus",function(a){var b=g.val(),d=b.length,e=a.type,f=+("keyup"===e&&(a.keyCode||a.which)),i=b!==c.previousValue,j=m(f),k="focus"===e;i&&(c.previousValue=b),j?c.keyHandler(f,a.target):(k||i&&c.trigger("change"))&&(c.isLength(d)?c.open(!k):l(h)&&c.close())}),h.on({focus:function(){var a=b(this),d={target:this,value:a.data("item-value"),label:a.text()};c.trigger("focus",d)},keyup:function(a){var b=a.keyCode||a.which||null;m(b)&&((b===j.up||b===j.down)&&a.preventDefault(),c.keyHandler(b,a.target))},click:function(a){a.preventDefault();var d=b(this),e=d.data("item-value"),f=d.text(),h={target:this,value:e,label:f};c.trigger("select",h)&&(g.val(e),g.data("item-label",f)),c.close()}},"a"),g.add(h).on({click:function(a){a.stopPropagation(),d.trigger("click",c)},keydown:function(a){var b=+("keydown"===a.type&&(a.keyCode||a.which));b===j.up||b===j.down?a.preventDefault():b===j.tab&&c.close()}}),c.trigger("create"),i.push(this),c},open:function(a){var b=this,c=+b.settings.delay;return execute=function(){b.fetch(b.method)},b.abort(),a===!0&&c>0?b.timeout=setTimeout(execute,c):execute(),this},abort:function(){var b=this;b.abortRequest(),b.timeout!==a&&(clearTimeout(b.timeout),delete b.timeout)},abortRequest:function(){var c=this,d=c.request;d!==a&&b.isFunction(d.abort)&&d.abort()},fetch:function(){var a,c=this,d=c.settings,e=c.method,f=c.$input.val(),g=c.latestQuery,h=d.source;if(a={query:f},"string"!==b.type(f)||!c.isLength(f.length)||!c.trigger("search",a))return c;if("string"===b.type(g)&&b.isArray(c.suggestions)&&f===g)return c.generate(),this;if(c.latestQuery=f,"function"===e)a={content:h.call(c.input,f)},c.trigger("response",a),c.suggestions=a.content,c.generate();else if("array"===e){var i=new RegExp("^"+f);a={content:b.grep(h,function(a){var c="string"===b.type(a)&&a||b.isPlainObject(a)&&"string"===b.type(a.value)&&a.value;return c.match(i)})},c.trigger("response",a),c.suggestions=a.content,c.generate()}else if("ajax"===e){var j=d.fieldName,k={};if(c.abortRequest(),"string"!==b.type(j))throw new Error("The field name is not a string.");k[d.fieldName]=f;var l=b.extend(!0,{},d.ajax,{url:h,data:k,success:function(e,f,g){var h=d.ajax.success;delete c.request,b.isFunction(h)&&h.call(this,e,f,g),a={content:e},c.trigger("response",a),c.suggestions=a.content,c.generate()}});c.request=b.ajax(l)}return c},generate:function(){var a=this,d=a.settings,e=+d.maxResults,f=a.suggestions,g=a.$input.val().split(/\s+/),h=a.$results,i=b(d.markupResultItem),j=b(d.markupResultLink),k=b(d.markupHighlight);if(!b.isArray(f))throw a.close(),new Error("The suggestions must be an Array");return f.length?("number"===b.type(e)&&e>0&&f.length>e&&(f=f.slice(0,e)),c.activeElement!==a.input&&a.$input.focus(),h.empty(),b.each(f,function(c,e){var f=i.clone(),l=j.clone(),m="string"===b.type(e),n=b.isPlainObject(e),o=m&&e||n&&b.type(e.value)&&e.value,p=a.escape(m&&e||n&&b.type(e.label)&&e.label);if(d.highlight){var q=b.map(g,function(b){return b.length>0?a.escape(b):null}),r=new RegExp(q.join("|"),"ig");p=p.replace(r,function(a){var b=k.clone().text(a),c=b[0].outerHTML;return c})}l.data("item-value",o).html(p),f.append(l),h.append(f)}),h.show(),a.trigger("open"),a):(a.close(),a)},keyHandler:function(a,c){var d=this,e=b(c),f=d.$results,g=d.$input,h=+a===j.enter,i=+a===j.esc,k=+a===j.up,m=+a===j.down,n=l(f),o=e[0]===g[0],p=n&&!o;if(h&&p)e.trigger("click");else if(i)d.close();else if((m||k)&&o&&d.isLength(g.val().length))n||d.open(),f.children(m&&":first-child"||k&&":last-child").children().focus();else if((k&&e.parent().is(":first-child")||m&&e.parent().is(":last-child"))&&p)g.focus();else if((m||k)&&p){var q=m&&"next"||k&&"prev";e.parent()[q]().children().focus()}return d},trigger:function(a){var c=this,d=c.settings[a],f=b.Event(e+a),g=Array.prototype.slice.call(arguments);return g.splice(0,1),c.$input.trigger(f,g),!(b.isFunction(d)&&d.apply(c.input,[f].concat(g))===!1||f.isDefaultPrevented())},close:function(){var a=this,b=a.$results;return a.abort(),b.hide().empty(),a.trigger("close"),a},destroy:function(){var c=this,d=(c.settings,c.$input),e=c.$results,f=b.inArray(c,i);e.remove(),c.$wrapper!==a&&d.unwrap(),d.replaceWith(c.original),f>-1&&i.splice(f,1)},escape:function(a){return b("<span>").text(a).html()},isOpen:function(){return l(this.$results)},isLength:function(a){var b=+this.settings.minLength;return b>0&&+a>=b||!b}},d.on("click."+e,function(a,c){b.each(i,function(){this.isOpen()&&c!==this&&this.close()})}),b.fn[e]=function(a){return this.each(function(){var c=this,d=b(this);if(!d.is("input")||!d.is(":not([type=file]):not([type=checkbox]):not([type=radio])"))throw new Error("Cannot add autocompletion to element other then input[type=text]");if("string"===b.type(a)&&a){var e=k(c);null!==e&&-1!==b.inArray(a,h)&&e[a]()}else new n(a).build(this)})}}).call(this);