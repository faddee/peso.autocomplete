/*! $.autocomplete a.k.a. peso.autocomplete v0.2.8 https://github.com/faddee/peso-autocomplete */(function(a){var b=this.$,c=b(document),d=this.PESO_AUTOCOMPELTE_NAME||"autocomplete",e={source:[],ajax:{},fieldName:"q",minLength:2,maxResults:10,delay:500,highlight:!0,create:null,change:null,search:null,response:null,open:null,focus:null,select:null,close:null,wrap:!0,classPrefix:d,classWrapper:"",classInput:"__input",classResultList:"__results",classResultItem:"__item",classResultLink:"__link",classHighlight:"__highlight"},f=function(a){return{markupWrapper:'<div class="'+a.classPrefix+a.classWrapper+'"></div>',markupResultList:'<ul class="'+a.classPrefix+a.classResultList+'"></ul>',markupResultItem:'<li class="'+a.classPrefix+a.classResultItem+'"></li>',markupResultLink:'<a class="'+a.classPrefix+a.classResultLink+'" href="#" tabindex="-1"></a>',markupHighlight:'<span class="'+a.classPrefix+a.classHighlight+'"></span>'}},g=["close","destroy"],h=[],i={enter:13,esc:27,up:38,down:40},j=function(a){return b.grep(h,function(b){return b.input===a})[0]||null},k=function(a){var c=b(a);return!(!c.width()&&!c.height())&&"none"!==c.css("display")},l=function(a){return a=+a,"number"===b.type(a)&&a>0&&(a===i.enter||a===i.esc||a===i.up||a===i.down)},m=function(a){var c=b.extend({},e,a);this.settings=b.extend({},f(c),c)};m.prototype={build:function(a){var e=this,f=e.settings,g=(e.suggestions=null,e.input=a,e.$input=b(a)),j=(e.original=g.clone()[0],e.$results=b(f.markupResultList));if("string"===b.type(f.classInput)&&g.addClass(f.classPrefix+f.classInput),f.wrap===!0){var m=e.$wrapper=b(f.markupWrapper);g.wrap(m)}return g.add(j).on("click."+d,function(a){a.stopPropagation()}),b.isFunction(f.source)?e.method="function":b.isArray(f.source)?e.method="array":"string"===b.type(f.source)&&(e.method="ajax"),g.attr("autocomplete","off").data("current-value",g.val()).on("keydown."+d+" focus."+d,function(a){var b=g.val(),f=b.length,h=a.type,m=+("keydown"===h&&(a.keyCode||a.which)),n=g.data("current-value"),o=b!==n,p=l(m),q="focus"===h;q&&!e.isOpen()&&c.trigger(d+"CloseAll"),o&&g.data("current-value",b),p?((m>0&&m===i.up||m===i.down)&&a.preventDefault(),e.keyHandler(m,a.target)):(q||o&&e.trigger("change"))&&(e.isLength(f)?e.open(!q):k(j)&&e.close())}),j.hide().insertAfter(g).on("focus."+d,"a",function(){var a=b(this),c={target:this,value:a.data("item-value"),label:a.text()};e.trigger("focus",c)}).on("keydown."+d,"a",function(a){var b=a.keyCode||a.which||null;l(b)&&((b===i.up||b===i.down)&&a.preventDefault(),e.keyHandler(b,a.target))}).on("click."+d,"a",function(a){var c=b(this),d=c.data("item-value"),f=c.text(),h={target:this,value:d,label:f};a.preventDefault(),e.trigger("select",h)&&(g.val(d),g.data("item-label",f).data("current-value",d)),e.close()}),e.trigger("create"),h.push(this),e},open:function(b){var c=this,d=c.settings.delay;return execute=function(){c.fetch(c.method)},c.timeout!==a&&(clearTimeout(c.timeout),delete c.timeout),b===!0&&+d>0?c.timeout=setTimeout(execute,d):execute(),this},fetch:function(){var c,d=this,e=d.settings,f=d.method,g=d.$input.val(),h=d.latestQuery,i=e.source;if(c={query:g},"string"!==b.type(g)||!d.isLength(g.length)||!d.trigger("search",c))return d;if("string"===b.type(h)&&b.isArray(d.suggestions)&&g===h)return d.generate(),this;if(d.latestQuery=g,"function"===f)c={content:i.call(d.input,g)},d.trigger("response",c),d.suggestions=c.content,d.generate();else if("array"===f){var j=new RegExp("^"+g);c={content:b.grep(i,function(a){var c="string"===b.type(a)&&a||b.isPlainObject(a)&&"string"===b.type(a.value)&&a.value;return c.match(j)})},d.trigger("response",c),d.suggestions=c.content,d.generate()}else if("ajax"===f){var k=e.fieldName,l={},m=d.request;if(m!==a&&b.isFunction(m.abort)&&m.abort(),"string"!==b.type(k))throw new Error("The field name is not a string.");l[e.fieldName]=g;var n=b.extend(!0,{},e.ajax,{url:i,data:l,success:function(a,f,g){var h=e.ajax.success;delete d.request,b.isFunction(h)&&h.call(this,a,f,g),c={content:a},d.trigger("response",c),d.suggestions=c.content,d.generate()}});d.request=b.ajax(n)}return d},generate:function(){var a=this,c=a.settings,d=+c.maxResults,e=a.suggestions,f=a.$input.val().split(/\s/),g=a.$results,h=b(c.markupResultItem),i=b(c.markupResultLink),j=b(c.markupHighlight);if(!b.isArray(e))throw a.close(),new Error("The suggestions must be an Array");return e.length?("number"===b.type(d)&&d>0&&e.length>d&&(e=e.slice(0,d)),g.empty(),b.each(e,function(d,e){var k=h.clone(),l=i.clone(),m="string"===b.type(e),n=b.isPlainObject(e),o=m&&e||n&&b.type(e.value)&&e.value,p=a.escape(m&&e||n&&b.type(e.label)&&e.label);c.highlight&&b.each(f,function(b,c){if(c.length>0){var d=a.escape(c),e=new RegExp(d,"ig");p=p.replace(e,function(a){var b=j.clone().text(a),c=b[0].outerHTML;return c})}}),l.data("item-value",o).html(p),k.append(l),g.append(k)}),g.show(),a.trigger("open"),a):(a.close(),a)},keyHandler:function(a,c){var e=this,f=b(c),g=e.$results,h=e.$input,j=+a===i.enter,l=+a===i.esc,m=+a===i.up,n=+a===i.down,o=k(g),p=f[0]===h[0],q=o&&!p;if(j&&q)f.trigger("click."+d);else if(l)e.close();else if((n||m)&&p&&e.isLength(h.val().length))o||e.open(),g.children(n&&":first-child"||m&&":last-child").children().focus();else if((m&&f.parent().is(":first-child")||n&&f.parent().is(":last-child"))&&q)h.focus();else if((n||m)&&q){var r=n&&"next"||m&&"prev";f.parent()[r]().children().focus()}return e},trigger:function(a){var c=this,e=c.settings[a],f=b.Event(d+a),g=Array.prototype.slice.call(arguments);return g.splice(0,1),c.$input.trigger(f,g),!(b.isFunction(e)&&e.apply(c.input,[f].concat(g))===!1||f.isDefaultPrevented())},close:function(){var a=this,b=a.$results;return b.hide().empty(),a.trigger("close"),a},destroy:function(){var c=this,d=(c.settings,c.$input),e=c.$results,f=b.inArray(c,h);e.remove(),c.$wrapper!==a&&d.unwrap(),d.replaceWith(c.original),f>-1&&h.splice(f,1)},escape:function(a){return b("<span>").text(a).html()},isOpen:function(){return k(this.$results)},isLength:function(a){var b=+this.settings.minLength;return b>0&&+a>=b||!b}},c.on(d+"CloseAll",function(){b.each(h,function(){var a=this;a.isOpen()&&a.close()})}),c.on("click",function(){b(this).trigger(d+"CloseAll")}),b.fn[d]=function(a){return this.each(function(){var c=this,d=b(this);if(!d.is("input")||!d.is(":not([type=file]):not([type=checkbox]):not([type=radio])"))throw new Error("Cannot add autocompletion to element other then input[type=text]");if("string"===b.type(a)&&a){var e=j(c);null!==e&&-1!==b.inArray(a,g)&&e[a]()}else new m(a).build(this)})}}).call(this);